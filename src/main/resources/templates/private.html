<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Private gallery</title>
    <style>

        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
          background-color: #f4f4f9;
          color: #333;
          display: flex;
          flex-direction: column;
          min-height: 100vh;
        }

        /* ===== Header ===== */
        header {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 3rem;
          background-color: #222;
          color: white;
          padding: 1rem 0;
          box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        header a {
          color: white;
          text-decoration: none;
          font-weight: bold;
          transition: color 0.3s;
        }

        header a:hover {
          color: #00bfff;
        }

        h2 {
          text-align: center;
          margin-top: 2rem;
          margin-bottom: 1rem;
          color: #222;
          font-size: 2rem;
          letter-spacing: 1px;
        }

        .gallery-container {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 1.5rem;
          padding: 2rem;
          width: 90%;
          max-width: 1200px;
          margin: 0 auto;
        }

        .gallery-item {
          background-color: white;
          border-radius: 10px;
          box-shadow: 0 4px 10px rgba(0,0,0,0.1);
          padding: 1rem;
          text-align: center;
          transition: transform 0.3s, box-shadow 0.3s;
        }

        .gallery-item:hover {
          transform: translateY(-5px);
          box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .gallery-item img {
          max-width: 100%;
          border-radius: 8px;
          margin-bottom: 0.5rem;
        }

        .gallery-item h4 {
          margin: 0.5rem 0;
          color: #333;
        }

        form[action="logout"] {
          display: flex;
          justify-content: center;
          padding: 1rem;
          margin-top: auto;
        }

        form[action="logout"] button {
          background-color: #d9534f;
          color: white;
          border: none;
          padding: 0.6rem 1.2rem;
          border-radius: 6px;
          font-weight: bold;
          cursor: pointer;
          transition: background-color 0.3s;
        }

        form[action="logout"] button:hover {
          background-color: #b52b27;
        }

        @media (max-width: 600px) {
          header {
            flex-direction: column;
            gap: 1rem;
          }

          .gallery-container {
            padding: 1rem;
          }
        }
    </style>
</head>
<body>

<header>
    <h3>
        <a href="/paint">PAINT</a>
    </h3>
    <h3>
        <a href="/private">PERSONAL GALLERY</a>
    </h3>
    <h3>
        <a href="/public">PUBLIC GALLERY</a>
    </h3>
    <h3>
        <a href="/shared">SHARED WITH ME</a>
    </h3>
    <h3>
        <a href="/trash">TRASH</a>
    </h3>
</header>

<h2>Personal Gallery</h2>

<div class="gallery-container">

    <p th:if="${#lists.isEmpty(paintList)}"
       style="grid-column: 1 / -1; text-align: center; font-size: 1.2rem; color: #555;">
        This place is empty....
    </p>

    <div class="gallery-item"
         th:each="paint : ${paintList}">

        <h4 th:text="${paint.name}"></h4>
        <p>Day creation: <span th:text="${paint.creationDate}"></span></p>
        <p>Last modification: <span th:text="${paint.lastModified}"></span></p>

        <button class="trash-btn"
                th:attr="data-id=${paint.id}">
            Move to trash
        </button>

        <button class="edit-btn"
                th:attr="data-name=${paint.name}">
            Edit
        </button>

        <button class="copy-btn" th:attr="data-id=${paint.id}">
            Copy
        </button>

        <button class="view-btn" th:attr="data-id=${paint.id}">
            View
        </button>

        <button class="versions-btn" th:attr="data-name=${paint.name}">
            View all versions
        </button>

        <button class="public-btn"
                th:attr="data-id=${paint.id}">
            Change show status
        </button>

        <button class="share-btn" th:attr="data-id=${paint.id}">
            Share
        </button>

    </div>

</div>

<form action="/logout" method="post" style="display:inline;">
    <button type="submit">Logout</button>
</form>


<script>

    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".copy-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                const paintId = btn.dataset.id;

                if (!confirm("Do you want to copy this drawing?")) return;

                fetch("/paint/copy", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: `paintId=${paintId}`
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert("Drawing copied successfully!");
                        location.reload();
                    } else {
                        alert("Error copying drawing: " + data.message);
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert("Failed to connect to the server.");
                });
            });
        });
    });

    document.addEventListener("DOMContentLoaded", () => {

        document.querySelectorAll(".trash-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                const paintId = btn.dataset.id;
                const confirmTrash = confirm("Move this paint to trash?");

                if (!confirmTrash) return;

                fetch("/paint/changeTrash", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: `paintId=${paintId}&isTrash=true`
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert("Moved to trash!");
                        location.reload();
                    } else {
                        alert("Error: " + data.message);
                    }
                });
            });
        });

            document.querySelectorAll(".share-btn").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const paintId = btn.dataset.id;
                    const username = prompt("Enter the username to share with:");
                    if (!username) return;
                    const canWrite = confirm("Allow write permission?");
                    const res = await fetch("/paint/share", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: `paintId=${paintId}&username=${username}&canWrite=${canWrite}`
                    });
                    const data = await res.json();
                    if (data.success) alert("Shared successfully!");
                    else alert("Error: " + data.message);
                });
            });


        document.querySelectorAll(".public-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                const paintId = btn.dataset.id;
                const isPublic = confirm("Make this paint public?");

                fetch("/paint/changePublic", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: `paintId=${paintId}&isPublic=${isPublic}`
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert("Status changed!");
                        location.reload();
                    } else {
                        alert("Error: " + data.message);
                    }
                });
            });
        });

    });

    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".view-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                const paintId = btn.dataset.id;

                window.location.href = "/paint/view?paintId=" + paintId;
            });
        });
    });

</script>


</body>
</html>